<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'primary': '#f5f5f4',
                    'secondary': '#E0E0E0',
                    'accent': '#3A3A3A',
                    'text-dark': '#212121',
                    'text-light': '#5A5A5A',
                    'card-one-bg': '#F5F5F5',
                    'card-two-bg': '#E0E0E0',
                    'card-three-bg': '#D3D3D3',
                    'section-bg-light-grey': '#F9F9F9',
                    'body-bg': '#f0f2f5',
                },
                fontFamily: {
                    professional: ['Lato', 'sans-serif'],
                    arabic: ['Cairo', 'sans-serif'],
                }
            }
        }
    }
</script>

<style>
    h1, h2, h3, h4, h5, h6 { font-family: 'Playfair Display', serif; }
    .our-products-title-font { font-family: 'Playfair Display', serif; }
    .attractive-text {
        font-family: 'Cairo', sans-serif;
        line-height: 1.6;
        font-size: 1.15rem; /* Default for larger screens */
        font-weight: bold;
        color: black;
    }
    .btn-discover {
        position: relative;
        font-family: 'Playfair Display', serif;
        background-color: transparent;
        border: 2px solid black;
        color: black;
        padding: 0.8rem 1.8rem;
        font-weight: bold;
        overflow: hidden;
        transition: color 0.4s ease-in-out, border-color 0.4s ease-in-out, background-color 0.4s ease-in-out;
        z-index: 1;
        display: inline-block;
    }
    @media (min-width: 768px) {
        .btn-discover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            z-index: -1;
            transform: scale(0);
            transform-origin: center;
            transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .btn-discover::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0);
            transition: all 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
            z-index: -1;
        }
        .btn-discover:hover {
            color: #C8A95A;
            border-color: #C8A95A;
        }
        .btn-discover:hover::before { transform: scale(1); }
        .btn-discover:hover::after {
            transform: translate(-50%, -50%) scale(2.5);
            opacity: 1;
        }
    }

    /* Skeleton loader styles */
    .skeleton {
            background: linear-gradient(-90deg, #e2e8f0 0%, #cbd5e1 50%, #e2e8f0 100%);
        animation: pulse 3s infinite ease-in-out;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2; /* Skeleton is above images initially */
    }
    .skeleton.hidden {
        opacity: 0;
        transition: opacity 0.5s ease-out;
        pointer-events: none;
        z-index: -1; /* Move skeleton out of the way once hidden */
    }
    @keyframes pulse {
        0% { background-color: #e2e8f0; }
        50% { background-color: #cbd5e1; }
        100% { background-color: #e2e8f0; }
    }
    
    .lazy-image {
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 0;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1; /* Images are behind the active skeleton */
    }
    .lazy-image.loaded {
        opacity: 1;
    }

    /* Before & After Slider - التصحيحات النهائية هنا */
    .before-after-slider {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: visible !important; /* Keep overflow hidden for the container to clip images */
    }
    .before-after-slider .before-img,
    .before-after-slider .after-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .before-after-slider .before-img {
        z-index: 10; /* Before image is clearly above after image when its visible */
            clip-path: inset(0); /* <--- أضف هذا السطر، هو الحل السحري */

    }
    .before-after-slider .after-img {
        z-index: 15; /* After image is on top, will be clipped */
        clip-path: polygon(0 0, var(--slider-pos, 50%) 0, var(--slider-pos, 50%) 100%, 0 100%);
    }
    .slider-handle {
        position: absolute;
        top: 0;
        bottom: 0;
        left: var(--slider-pos, 50%); /* Starts at 50% (center) */
        width: 4px;
        background: white;
        transform: translateX(-50%);
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        z-index: 30;
        pointer-events: none;
    }
    .drag-circle {
        position: absolute;
        top: 50%;
        left: var(--slider-pos, 50%); /* Starts at 50% (center) */
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        background: white;
        border: 4px solid #C8A95A;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: 'Cairo', sans-serif;
        font-weight: bold;
        color: #C8A95A;
        font-size: 12px; /* Default small size */
        z-index: 30;
        cursor: grab;
        pointer-events: auto;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        transition: transform 0.2s ease-in-out, font-size 0.2s ease-in-out; /* Smooth transition for icon/text changes */
    }
    .drag-circle:active {
        cursor: grabbing;
        transform: translate(-50%, -50%) scale(0.95);
    }
    .drag-circle svg {
        width: 24px;
        height: 24px;
        margin-bottom: 2px;
        transition: transform 0.2s ease-in-out; /* Smooth transition for icon rotation */
    }

    /* Specific styles for drag circle text and icon */
    .drag-circle .drag-text {
        font-size: 0.7rem; /* Much smaller font size for "اسحب" */
        line-height: 1; /* Adjust line height for smaller text */
        margin-top: -4px; /* Move up slightly to center */
    }
    .drag-circle.direction-ltr svg {
        transform: rotateY(0deg); /* Default LTR (right arrows) */
    }
    .drag-circle.direction-rtl svg {
        transform: rotateY(180deg); /* RTL (left arrows) */
    }


    /* باقي الـ CSS زي ما هو بالضبط بدون أي تغيير */
    .fade-in-section {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 1s ease-out, transform 1s ease-out;
    }
    .fade-in-section.is-visible {
        opacity: 1;
        transform: translateY(0);
    }

    /* Mobile styles */
    @media (max-width: 767px) {
        .history-section {
            padding: 1rem 0.5rem;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
       .history-image-wrapper {
            display: block;
            /* سنزيد المساحة الفارغة من 2rem إلى 5rem لكي يظهر الزر */
            width: calc(100% - 5rem); 
            height: 340px;
            margin: 1rem auto;
            overflow: visible; /* تأكيد إضافي */
        }
      
        .our-products-title-font {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            margin-top: 1rem;
        }
        .attractive-text {
            font-size: 0.85rem; /* Adjusted font size for small screens */
            margin-bottom: 1rem;
            max-width: 95%; /* Added max-width and auto margins for centering */
            margin-left: auto;
            margin-right: auto;
        }
        .btn-discover {
            padding: 0.6rem 1.4rem;
            font-size: 0.9rem;
            margin: 1rem auto;
        }
        .content-wrapper {
            flex-direction: column;
        }
        .history-content {
            width: 100%;
        }
        .drag-circle {
            width: 56px;
            height: 56px;
            font-size: 11px;
        }
        .drag-circle svg {
            width: 22px;
            height: 22px;
        }
        .drag-circle .drag-text {
            font-size: 0.65rem; /* Even smaller on mobile */
        }
    }

    @media (min-width: 768px) {
        .history-section {
            padding-top: 3rem;
            padding-bottom: 3rem;
            flex-direction: column;
            align-items: center;
        }
        .our-products-title-font {
            font-size: 2.5rem;
            margin-bottom: 1.8rem;
        }
        .content-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            max-width: 1000px;
            width: 100%;
        }
        .history-image-wrapper {
            flex-shrink: 0;
            width: 350px;
            height: 500px;
            max-width: none;
            margin-bottom: 0;
            display: block;
            overflow: visible;
        }
        .history-content {
            width: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            text-align: right;
        }
        .attractive-text {
            font-size: 1.05rem; /* Adjusted font size for larger screens */
            max-width: 100%;
            margin-bottom: 1.5rem;
        }
        @media (max-width: 1023px) and (min-width: 768px) {
             .history-image-wrapper {
                width: 300px;
                height: 450px;
            }
            .history-content {
                width: 380px;
            }
        }
    }
</style>

<section class="history-section py-16 bg-transparent flex flex-col items-center fade-in-section" style="direction: ltr;">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col items-center">
        <div class="flex justify-center items-center mb-10 mx-auto">
            <h2 class="text-4xl font-bold text-text-dark our-products-title-font">لمسة تغيّر كل شيء</h2>
        </div>
        <div class="content-wrapper w-full flex flex-col md:flex-row items-center justify-center">
<div class="history-image-wrapper relative z-50 md:order-1">
                    <div class="before-after-slider">
                    <!-- The skeleton for the BEFORE image -->
                    <div class="skeleton before-skeleton"></div>
                    <!-- before-img is at the bottom -->
                    <img data-src="https://i.pinimg.com/736x/4f/a9/f0/4fa9f07328cfcbd48931f27ec2ea7410.jpg" alt="قبل" class="lazy-image before-img" loading="lazy">
                    
                    <!-- The skeleton for the AFTER image -->
                    <div class="skeleton after-skeleton"></div>
                    <!-- after-img is on top, its visibility controlled by clip-path -->
                    <img data-src="https://i.pinimg.com/736x/43/68/c8/4368c81e65ece6ec205fed82189e53a9.jpg" alt="بعد" class="lazy-image after-img" loading="lazy">
                    
                    <div class="slider-handle"></div>
                    <div class="drag-circle direction-ltr"> <!-- Added default direction-ltr class -->
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
                        </svg>
                        <span class="drag-text">اسحب</span> <!-- Added class for text styling -->
                    </div>
                </div>
            </div>

            <div class="history-content text-gray-700 relative z-10 mt-8 md:mt-0 md:mr-8 md:order-2">
               <p class="attractive-text mb-8" style="line-height: 1.9; direction: rtl;">
    احصل الآن على 
    <span style="color:#C8A95A;">خصم حصري بنسبة 40%</span>
    للمشترين الأوائل عند طلب هذا الباك المميز الذي يجمع بين ساعة فاخرة، عطراً راقياً، وسواراً أنيقاً. 
    مجموعة متكاملة تمنحك مظهراً أنيقاً ورائحة تدوم وتعبّر عن أسلوبك المميز.
    <br><br>
    العرض متاح لفترة محدودة فقط، ولضمان حصولك على هذا الخصم قبل انتهائه، اضغط على الزر أدناه واطلبه الآن!
</p>
                <div class="text-right w-full flex justify-center md:justify-center">
                    <button class="btn-discover text-lg">
                        اشتري الآن
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const slider = document.querySelector('.before-after-slider');
        const circle = slider.querySelector('.drag-circle');
        const circleSvg = circle.querySelector('svg');
        let isDragging = false;

        const updateSlider = (x) => {
            const rect = slider.getBoundingClientRect();
            const width = rect.width;
            
            // Allow slider to go from 0 to width (full range), ignoring circle size for calculation
            // The circle's transform:translateX(-50%) will handle its centering.
            let posInPixels = (x - rect.left); 
            
            // Clamp posInPixels to be within the full width of the slider (0 to width)
            posInPixels = Math.max(0, Math.min(width, posInPixels));

            const posPercentage = (posInPixels / width) * 100;
            slider.style.setProperty('--slider-pos', posPercentage + '%');

            // Logic to change arrow direction
            if (posPercentage > 85) { // Near right edge
                circle.classList.remove('direction-ltr');
                circle.classList.add('direction-rtl');
            } else { // Anywhere else (middle or left)
                circle.classList.remove('direction-rtl');
                circle.classList.add('direction-ltr');
            }
        };

        // Initial position: Start the slider exactly in the center (50%)
        updateSlider(slider.getBoundingClientRect().left + slider.getBoundingClientRect().width / 2); 

        // Manual dragging
        circle.addEventListener('mousedown', (e) => { 
            isDragging = true; 
            updateSlider(e.clientX); 
            e.preventDefault(); // Prevent text selection on desktop
        });
        document.addEventListener('mousemove', (e) => { 
            if (isDragging) updateSlider(e.clientX); 
        });
        document.addEventListener('mouseup', () => { 
            isDragging = false; 
        });

        circle.addEventListener('touchstart', (e) => { 
            isDragging = true; 
            updateSlider(e.touches[0].clientX); 
            // Only prevent default if we are actively dragging the slider
            // This allows vertical scrolling outside the active drag
            if (e.cancelable) { // Check if preventDefault is even allowed
                e.preventDefault(); 
            }
        }, { passive: false }); // passive: false is needed for preventDefault() to work
        
        document.addEventListener('touchmove', (e) => { 
            if (isDragging) {
                updateSlider(e.touches[0].clientX); 
                if (e.cancelable) {
                    e.preventDefault(); // Prevent page scrolling ONLY when dragging the slider
                }
            }
        }, { passive: false });
        
        document.addEventListener('touchend', () => { 
            isDragging = false; 
        });

        // Lazy load and fade-in for images
        const lazyImages = document.querySelectorAll('.lazy-image');
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.onload = () => {
                        img.classList.add('loaded');
                        const skeleton = img.previousElementSibling; 
                        if (skeleton && skeleton.classList.contains('skeleton')) {
                            skeleton.classList.add('hidden'); 
                        }
                    };
                    observer.unobserve(img);
                }
            });
        });

        lazyImages.forEach(img => {
            imageObserver.observe(img);
        });

        // Fade-in sections
        const fadeInSections = document.querySelectorAll('.fade-in-section');
        const sectionObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 }); 

        fadeInSections.forEach(section => {
            sectionObserver.observe(section);
        });
    });
</script>